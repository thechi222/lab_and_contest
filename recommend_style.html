{% load static humanize %}
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI 室內設計推薦結果</title>
    <link rel="stylesheet" href="{% static 'css/recommend_style.css' %}">
</head>
<body>
    <header>AI 室內設計推薦結果</header>

    <main>
        
        {# 頂部用戶資訊欄 #}
        <div class="user-info-bar">
            您的房間坪數：
            <div class="user-area-display">{{ room_area }}</div>
            <span class="area-value">({{ display_analysis_basis }})</span>
            <span class="user-budget">總預算：{{ total_budget }}</span>
        </div>

        {# AI 推薦風格區塊 #}
        <div class="style-section">
            <h2>AI 推薦風格</h2>

            <div class="cards-container">
                {% if recommendations %}
                    {# 遍歷所有的推薦風格 (多張卡片) #}
                    {% for style_name, items in recommendations.items %}
                        <div class="style-card-container">
                            
                            {# 風格卡片主體 #}
                            <div class="style-card" onclick="toggleExpand('{{ forloop.counter }}')">
                                <div class="card-header">
                                    <span class="style-name">{{ style_name|default:"推薦風格" }}</span>
                                </div>
                                <div class="card-main">
                                    <div class="style-total-price">
                                        {# 總價計算：使用 views.py 中計算好的 total_cost 變數 #}
                                        總價: NT$ <span class="style-price-amount">{{ items.total_cost|default:0|intcomma }}</span>
                                    </div>
                                    <div class="action-icon">＋</div>
                                </div>
                                <div class="card-footer">
                                    {# 風格概要 #}
                                    {{ items.style_summary|default:"風格概要：基礎裝修建議" }}
                                </div>
                            </div>

                            {# 展開區域：只顯示指定三個項目 #}
                            <div class="expand-section" id="expand-{{ forloop.counter }}" style="display:none;">
                                <div class="recommendations-container">
                                    
                                    {# 1. 壁紙/油漆 #}
                                    <div class="recommendation-card">
                                        <span class="recommendation-tag">壁紙/油漆</span>
                                        <div class="recommendation-price">
                                            <span class="currency">NT$</span> 
                                            <span class="amount">{{ items.wallpaper.price|default:0|intcomma }}</span>
                                        </div>
                                        <div class="recommendation-details">
                                            <div class="detail-label">型號：</div>
                                            <div class="detail-value">{{ items.wallpaper.name|default:"N/A" }}</div>
                                        </div>
                                    </div>

                                    {# 2. 地板 #}
                                    <div class="recommendation-card">
                                        <span class="recommendation-tag">地板</span>
                                        <div class="recommendation-price">
                                            <span class="currency">NT$</span> 
                                            <span class="amount">{{ items.flooring.price|default:0|intcomma }}</span>
                                        </div>
                                        <div class="recommendation-details">
                                            <div class="detail-label">型號：</div>
                                            <div class="detail-value">{{ items.flooring.name|default:"N/A" }}</div>
                                        </div>
                                    </div>

                                    {# 3. 天花板 #}
                                    <div class="recommendation-card">
                                        <span class="recommendation-tag">天花板</span>
                                        <div class="recommendation-price">
                                            <span class="currency">NT$</span> 
                                            <span class="amount">{{ items.ceiling.price|default:0|intcomma }}</span>
                                        </div>
                                        <div class="recommendation-details">
                                            <div class="detail-label">型號：</div>
                                            <div class="detail-value">{{ items.ceiling.name|default:"N/A" }}</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                {% else %}
                    <p>沒有推薦商品</p>
                {% endif %}
            </div>
        </div>

        {# AI 分析與建議區塊 #}
        <div class="style-section" style="margin-top: 30px;">
            <h2>AI 分析與建議</h2>

            <div class="recommendation-details">
                <div class="detail-label">建議風格：</div>
                <div class="detail-value">{{ ai_recommendation.style_suggestions }}</div>
            </div>

            <div class="recommendation-details">
                <div class="detail-label">空間優化建議：</div>
                <div class="detail-value">{{ ai_recommendation.space_optimization|linebreaksbr }}</div>
            </div>

            <div class="recommendation-details">
                <div class="detail-label">產品重點：</div>
                <div class="detail-value">{{ ai_recommendation.product_focus|linebreaksbr }}</div>
            </div>

            <div class="recommendation-details">
                <div class="detail-label">Gemini 坪數分析：</div>
                <div class="detail-value">{{ gemini_analysis|linebreaksbr }}</div>
            </div>

            <div class="recommendation-details">
                <div class="detail-label">總預算：</div>
                <div class="detail-value">{{ total_budget }}</div>
            </div>
        </div>
    </main>

    <script>
        function toggleExpand(id) {
            const expand = document.getElementById(`expand-${id}`);
            const card = expand.closest('.style-card-container').querySelector('.style-card');
            const icon = card.querySelector('.action-icon');

            if (expand.style.display === 'block') {
                expand.classList.remove('show');
                icon.textContent = '＋';
                setTimeout(() => {
                    expand.style.display = 'none';
                    card.classList.remove('expanded');
                }, 300);
            } else {
                expand.style.display = 'block';
                card.classList.add('expanded');
                icon.textContent = '－';
                setTimeout(() => {
                    expand.classList.add('show');
                }, 10);
            }
        }
    </script>
</body>
</html>